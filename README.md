# Keycloak API demos

## Getting a list of realm users

Keycloak Admin REST API:
http://www.keycloak.org/docs/rest-api/index.html#_get_users

Usage:
   GET /admin/realms/{realm}/users

   * realm is a name of the user's realm. Required

### Example

Pre-requisites: an existing service client. 
- Get a list of OpenID Connect endpoints:
```
curl https://keycloakhost:keycloakport/auth/realms/{realm}/.well-known/openid-configuration

```
  - Assuming the server is running on online.stk.com:8443, the request is then will be:

```
curl https://<host>:8443/auth/realms/master/.well-known/openid-configuration
```

- Make a note of the token_endpoint property in the json document returned by the previous call, you will need it to request an access token.
```
https://<host>:8443/auth/realms/master/protocol/openid-connect/token
```

- Obtain an access token using the value of the token_endpoint:
```
curl https://<host>:8443/auth/realms/master/protocol/openid-connect/token -H "Authorization: Basic Base64(client_id:client_secret)"
```
  - the client_id is 'service-account-client'
  - the client_secret is '9e853caa-9956-4505-9299-4dd83bd0069b'
  - the base64 encoded value is 'c2VydmljZS1hY2NvdW50LWNsaWVudDo5ZTg1M2NhYS05OTU2LTQ1MDUtOTI5OS00ZGQ4M2JkMDA2OWI='

Note: to encode clent_id:client_secret, use base64 package in python and the method 'urlsafe_b64encode(bytes(..., 'ascii'))  
```
curl https://<host>:8443/auth/realms/master/protocol/openid-connect/token -H "Authorization: Basic c2VydmljZS1hY2NvdW50LWNsaWVudDo5ZTg1M2NhYS05OTU2LTQ1MDUtOTI5OS00ZGQ4M2JkMDA2OWI="
```
The response is an JSON document containing access, refresh and id tokens:
```
{
"access_token":"eyJhbGciOiJSUzI1NiIsInR5cCIgOiAiSldUIiwia2lkIiA6ICJBSE5nSVVGVGlIQ2sxcS1xV09WbVR3U0x4NFlWRnd4eEIyMkMwVW5KemZvIn0.eyJqdGkiOiI3MWM0MTc0NS1jODExLTQ5NTQtYmVhMS1jMDE1YzZmNWExOTMiLCJleHAiOjE0NzgyNDQzMjEsIm5iZiI6MCwiaWF0IjoxNDc4MjQ0MjYxLCJpc3MiOiJodHRwczovL29ubGluZS5zdGsuY29tOjg0NDMvYXV0aC9yZWFsbXMvbWFzdGVyIiwiYXVkIjoic2VydmljZS1hY2NvdW50LWNsaWVudCIsInN1YiI6IjRlMDU4ZGNlLTU0NDEtNGQyNS05YTM2LTdhNTFjMmEzMTBlZCIsInR5cCI6IkJlYXJlciIsImF6cCI6InNlcnZpY2UtYWNjb3VudC1jbGllbnQiLCJhdXRoX3RpbWUiOjAsInNlc3Npb25fc3RhdGUiOiI0ZmNkODZlYi0yZjdlLTQwYTYtYTY2MS1kMjBiMWE4MTE5N2YiLCJhY3IiOiIxIiwiY2xpZW50X3Nlc3Npb24iOiJkYzFkZWRjNC0zMmQ5LTRiMzEtODljMi1iYmMwZTJjNzM2YjgiLCJhbGxvd2VkLW9yaWdpbnMiOlsiKiJdLCJyZWFsbV9hY2Nlc3MiOnsicm9sZXMiOlsidW1hX2F1dGhvcml6YXRpb24iXX0sInJlc291cmNlX2FjY2VzcyI6eyJzZXJ2aWNlLWFjY291bnQtY2xpZW50Ijp7InJvbGVzIjpbInVtYV9wcm90ZWN0aW9uIl19LCJhY2NvdW50Ijp7InJvbGVzIjpbIm1hbmFnZS1hY2NvdW50Iiwidmlldy1wcm9maWxlIl19fSwiY2xpZW50SWQiOiJzZXJ2aWNlLWFjY291bnQtY2xpZW50IiwiY2xpZW50SG9zdCI6IjEyNy4wLjAuMSIsIm5hbWUiOiIiLCJwcmVmZXJyZWRfdXNlcm5hbWUiOiJzZXJ2aWNlLWFjY291bnQtc2VydmljZS1hY2NvdW50LWNsaWVudCIsImNsaWVudEFkZHJlc3MiOiIxMjcuMC4wLjEiLCJlbWFpbCI6InNlcnZpY2UtYWNjb3VudC1zZXJ2aWNlLWFjY291bnQtY2xpZW50QHBsYWNlaG9sZGVyLm9yZyJ9.I-7QCqqBfhHqiexr3JteNQw0GhmDglHsOUln2IIQg_5grOlyFFR8l1tDxxg0kPapLbGFqz7FHZ8yTsj6usds-R-ry_ovmxd8jZ3SJ9tfq-GXDHqw1-4ItUV12iWtCH4LFP4rTGhjbNPI2AOA4yorZD7tpl6-bJV-fRkJnBiy75cUpKYXWEIXCClbbGmDBG2fLZx1EK0k43heqwGZZ-IIP1pR-8W6LZB38pesk83rX8iAE2V7VA3sjKm9nLHsYSzd3b27XUO1h-bsojKT6Es67TsAuio_UkGYNkdU_sc0-i_SespP9laLXkp2RUSxfO1BRoJASXX7tc6DNOPQFdbQKA",
"expires_in":60,
"refresh_expires_in":1800,
"refresh_token":"eyJhbGciOiJSUzI1NiIsInR5cCIgOiAiSldUIiwia2lkIiA6ICJBSE5nSVVGVGlIQ2sxcS1xV09WbVR3U0x4NFlWRnd4eEIyMkMwVW5KemZvIn0.eyJqdGkiOiIzY2QyZTUxYS0yNTNlLTQyZWEtYTM3My0yYWRhOWM1MjU2YzUiLCJleHAiOjE0NzgyNDYwNjEsIm5iZiI6MCwiaWF0IjoxNDc4MjQ0MjYxLCJpc3MiOiJodHRwczovL29ubGluZS5zdGsuY29tOjg0NDMvYXV0aC9yZWFsbXMvbWFzdGVyIiwiYXVkIjoic2VydmljZS1hY2NvdW50LWNsaWVudCIsInN1YiI6IjRlMDU4ZGNlLTU0NDEtNGQyNS05YTM2LTdhNTFjMmEzMTBlZCIsInR5cCI6IlJlZnJlc2giLCJhenAiOiJzZXJ2aWNlLWFjY291bnQtY2xpZW50IiwiYXV0aF90aW1lIjowLCJzZXNzaW9uX3N0YXRlIjoiNGZjZDg2ZWItMmY3ZS00MGE2LWE2NjEtZDIwYjFhODExOTdmIiwiY2xpZW50X3Nlc3Npb24iOiJkYzFkZWRjNC0zMmQ5LTRiMzEtODljMi1iYmMwZTJjNzM2YjgiLCJyZWFsbV9hY2Nlc3MiOnsicm9sZXMiOlsidW1hX2F1dGhvcml6YXRpb24iXX0sInJlc291cmNlX2FjY2VzcyI6eyJzZXJ2aWNlLWFjY291bnQtY2xpZW50Ijp7InJvbGVzIjpbInVtYV9wcm90ZWN0aW9uIl19LCJhY2NvdW50Ijp7InJvbGVzIjpbIm1hbmFnZS1hY2NvdW50Iiwidmlldy1wcm9maWxlIl19fX0.RTkgImRVTwiU7O9LoDBLfthc28EnInK4reK7p_8XGgHObK8HxujxrKKmPSH2eeUjdcPLH9Cu8JJdn7hjPsBoRg161bjow4JTx-g1zvZw6nxYIgUjxI3pNDkNlpNCr4vOhmFDkRqGkQje4UmiAEkQwAzAGHA-ttw7CZ6awCJd-PBVASuQ251k1OjDYiGoX4H6QVglmp8VbZRSzivALeQFwL6AjXFZ95wlHLjruV4SyM8vkXrxngVa-lRqBrW0-6l_Lz7ZU4Pl6pT7pLPfEnsYm4E3UV6PM_NdTggDIif2UKUZIvjLyd1yAo-JoHGLEJ93Ln8GuYjoWVK-RAywuHWPFA",
"token_type":"bearer",
"id_token":"eyJhbGciOiJSUzI1NiIsInR5cCIgOiAiSldUIiwia2lkIiA6ICJBSE5nSVVGVGlIQ2sxcS1xV09WbVR3U0x4NFlWRnd4eEIyMkMwVW5KemZvIn0.eyJqdGkiOiI4NjRkNDBkYy1kMDlkLTQwZjEtOWE4Mi1iMDVkNGE1Njk0NTUiLCJleHAiOjE0NzgyNDQzMjEsIm5iZiI6MCwiaWF0IjoxNDc4MjQ0MjYxLCJpc3MiOiJodHRwczovL29ubGluZS5zdGsuY29tOjg0NDMvYXV0aC9yZWFsbXMvbWFzdGVyIiwiYXVkIjoic2VydmljZS1hY2NvdW50LWNsaWVudCIsInN1YiI6IjRlMDU4ZGNlLTU0NDEtNGQyNS05YTM2LTdhNTFjMmEzMTBlZCIsInR5cCI6IklEIiwiYXpwIjoic2VydmljZS1hY2NvdW50LWNsaWVudCIsImF1dGhfdGltZSI6MCwic2Vzc2lvbl9zdGF0ZSI6IjRmY2Q4NmViLTJmN2UtNDBhNi1hNjYxLWQyMGIxYTgxMTk3ZiIsImFjciI6IjEiLCJjbGllbnRJZCI6InNlcnZpY2UtYWNjb3VudC1jbGllbnQiLCJjbGllbnRIb3N0IjoiMTI3LjAuMC4xIiwibmFtZSI6IiIsInByZWZlcnJlZF91c2VybmFtZSI6InNlcnZpY2UtYWNjb3VudC1zZXJ2aWNlLWFjY291bnQtY2xpZW50IiwiY2xpZW50QWRkcmVzcyI6IjEyNy4wLjAuMSIsImVtYWlsIjoic2VydmljZS1hY2NvdW50LXNlcnZpY2UtYWNjb3VudC1jbGllbnRAcGxhY2Vob2xkZXIub3JnIn0.cHS93zJ4kp7TUqXjDGFNI7a2AwLH2EpCFXLHWv_ErRDRA6lzFvulKUjnk_ll-wAT7NWrqUBlUlGmmuEZU9F48XlrKVEOhe5GiZ3lvTLzdp2xQpAYz_LmHuYCPaJQxlvmHa5pVc_bw90lzAGkWIXODTo8_EE0_10EbD41l1L_-dqu6jHUyCcrazvuNC2RkUne_50Ic2GH0o4fTNh18-17mZ5EsATdGkW_I1dlAmc9C2WuT63pFZOz9WGGO1CBOJ13IXbvHQBbU9VN_hjJ_-vX9_C-rvt_fJUN7F8-ljKf77eIdmWnbfdGnF84fVgGdSXHqKS7ujq4UO7vOH65qohGEg",
"not-before-policy":0,
"session_state":"4fcd86eb-2f7e-40a6-a661-d20b1a81197f"
}
```
- Use the value of the access token to request a list of realm users:
```
curl --insecure https://<host>:8443/auth/admin/realms/master/users -H 'Authorization: Bearer eyJhbGciOiJSUzI1NiIsInR5cCIgOiAiSldUIiwia2lkIiA6ICJBSE5nSVVGVGlIQ2sxcS1xV09WbVR3U0x4NFlWRnd4eEIyMkMwVW5KemZvIn0.eyJqdGkiOiI3MWM0MTc0NS1jODExLTQ5NTQtYmVhMS1jMDE1YzZmNWExOTMiLCJleHAiOjE0NzgyNDQzMjEsIm5iZiI6MCwiaWF0IjoxNDc4MjQ0MjYxLCJpc3MiOiJodHRwczovL29ubGluZS5zdGsuY29tOjg0NDMvYXV0aC9yZWFsbXMvbWFzdGVyIiwiYXVkIjoic2VydmljZS1hY2NvdW50LWNsaWVudCIsInN1YiI6IjRlMDU4ZGNlLTU0NDEtNGQyNS05YTM2LTdhNTFjMmEzMTBlZCIsInR5cCI6IkJlYXJlciIsImF6cCI6InNlcnZpY2UtYWNjb3VudC1jbGllbnQiLCJhdXRoX3RpbWUiOjAsInNlc3Npb25fc3RhdGUiOiI0ZmNkODZlYi0yZjdlLTQwYTYtYTY2MS1kMjBiMWE4MTE5N2YiLCJhY3IiOiIxIiwiY2xpZW50X3Nlc3Npb24iOiJkYzFkZWRjNC0zMmQ5LTRiMzEtODljMi1iYmMwZTJjNzM2YjgiLCJhbGxvd2VkLW9yaWdpbnMiOlsiKiJdLCJyZWFsbV9hY2Nlc3MiOnsicm9sZXMiOlsidW1hX2F1dGhvcml6YXRpb24iXX0sInJlc291cmNlX2FjY2VzcyI6eyJzZXJ2aWNlLWFjY291bnQtY2xpZW50Ijp7InJvbGVzIjpbInVtYV9wcm90ZWN0aW9uIl19LCJhY2NvdW50Ijp7InJvbGVzIjpbIm1hbmFnZS1hY2NvdW50Iiwidmlldy1wcm9maWxlIl19fSwiY2xpZW50SWQiOiJzZXJ2aWNlLWFjY291bnQtY2xpZW50IiwiY2xpZW50SG9zdCI6IjEyNy4wLjAuMSIsIm5hbWUiOiIiLCJwcmVmZXJyZWRfdXNlcm5hbWUiOiJzZXJ2aWNlLWFjY291bnQtc2VydmljZS1hY2NvdW50LWNsaWVudCIsImNsaWVudEFkZHJlc3MiOiIxMjcuMC4wLjEiLCJlbWFpbCI6InNlcnZpY2UtYWNjb3VudC1zZXJ2aWNlLWFjY291bnQtY2xpZW50QHBsYWNlaG9sZGVyLm9yZyJ9.I-7QCqqBfhHqiexr3JteNQw0GhmDglHsOUln2IIQg_5grOlyFFR8l1tDxxg0kPapLbGFqz7FHZ8yTsj6usds-R-ry_ovmxd8jZ3SJ9tfq-GXDHqw1-4ItUV12iWtCH4LFP4rTGhjbNPI2AOA4yorZD7tpl6-bJV-fRkJnBiy75cUpKYXWEIXCClbbGmDBG2fLZx1EK0k43heqwGZZ-IIP1pR-8W6LZB38pesk83rX8iAE2V7VA3sjKm9nLHsYSzd3b27XUO1h-bsojKT6Es67TsAuio_UkGYNkdU_sc0-i_SespP9laLXkp2RUSxfO1BRoJASXX7tc6DNOPQFdbQKA'
```

